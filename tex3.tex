\ExplSyntaxOn

\cs_new:Npn \getLetter{H} % Example function returning 'A'

\cs_gset:Npn \runForDays #1#2#3
{
  \seq_set_split:Nnn \l_tmpa_seq { ~ } { #1 }
  \seq_map_inline:Nn \l_tmpa_seq
    {
      \str_case:nn {##1}
        {
          {W}{#2}
          {R}{#3}
        }
    }
}

\cs_gset:Npn \createDayTimeSlots #1
{
  \runForDays{#1}{\aDay{123}}{& 0 \insertRestDaySpace}
}

\cs_gset:Npn \createDayHeader #1
{
  \runForDays{#1}{\ipaDayHeader{1.1.190}}{\holidyDayHeader{}}
}

\cs_gset:Npn \calcDays #1
{
  \runForDays{#1}{\addIpaDay}{\addRestDay}
}

\cs_gset:Npn \getDayIndex #1
{
  \int_div_truncate:nn {#1}{\blockAmountPerIpaDay} + 1
}

\NewDocumentCommand{\createGetDay}{m}{
  \cs_gset:Npn \getDay ##1{
    \tl_item:nn {#1}{\getDayIndex{##1}}
  }
}

\cs_gset:Npn \insertRestDaySpace{
  \Repeat{\hiddnRestColls}{&}
}

\NewDocumentCommand{\createTimeslot}{m}{
  \cs_gset:Npn \timeslot ##1##2{
    \ifnum\arabic{##1}>0\relax
      \emptycells{\arabic{##1}}
    \fi

  \bool_while_do:nn
    {
      \str_compare_p:eNe { \getDay{\arabic{##1}} } = { R }
    }
    {
      \Repeat{\blockAmountPerIpaDay}{\addtocounter{##1}{1}&}
      % \addtocounter{##1}{16}&&&&&&&&&&&&&&&&
    }

    % \str_if_eq:eeT
    %   { \getDay{\arabic{##1}} }
    %   { R }
    %   { \addtocounter{##1}{1}& }

    \Greencells{##2}{##2 (\arabic{##1}) ()} &
    \emptycells{\numexpr\number\blockAmount-\arabic{##1}- (##2) -1\relax} 
    \addtocounter{##1}{\number##2}
  }
}
\ExplSyntaxOff{}