\documentclass{report}

\usepackage[
    a4paper,
    total={150mm, 237mm},
    left=30mm,
    top=30mm,
]{geometry}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
% \usepackage{hyperref}
\usepackage{graphicx}
\usepackage[english]{babel}
\usepackage{multirow}
\usepackage[table,xcdraw,  x11names]{xcolor}
\usepackage{makecell, hhline} 
\usepackage{tabstackengine} 
\usepackage{etex} 
\usepackage{pgffor}
\usepackage{expl3}
\usepackage{typearea} % Page layout
\usepackage{tabularray}
\usepackage{array} % needed for \newcolumntype
\usepackage{xparse}
% \usepackage{listofitems}
\usepackage{multirow}
% \usepackage{booktabs,siunitx}






\usepackage{cellspace}
\setlength\cellspacetoplimit{1ex}
\setlength\cellspacebottomlimit{1ex}
\def\thickvrule{\vrule width 1.5mm}
\def\bluevrule{\color[HTML]{BBDAFF}\vrule width1pt}

\input{commands.tex}

\ExplSyntaxOn

\cs_gset:Npn \runForDays #1#2#3
{
  \seq_set_split:Nnn \l_tmpa_seq { ~ } { #1 }
  \seq_map_inline:Nn \l_tmpa_seq
    {
      \str_case:nn {##1}
        {
          {A}{#2}
          {H}{#3}
        }
    }
}

\cs_gset:Npn \createDayTimeSlots #1
{
  \runForDays{#1}{\aDay{123}}{0 &}
}

\cs_gset:Npn \createDayHeader #1
{
  \runForDays{#1}{\ipaDayHeader{1.1.190}}{\holidyDayHeader{}}
}

\cs_gset:Npn \calcDays #1
{
  \runForDays{#1}{\addIpaDay}{\addRestDay}
}

% Declare a global sequence to hold workday values
\seq_new:N \g_workday_seq

\NewDocumentCommand{\createIsWorkdayCommand}{mm}
{
    \cs_gset:Npn \isWorkday ##1
      {
        \seq_set_split:Nnn \g_workday_seq { ~ } { #2 }
        \seq_item:Nn \g_workday_seq {\int_eval:n{\int_div_truncate:nn {##1}{16} +2}}
      }

      \cs_gset:Npn \hasHolidayDays:nn ##1 ##2
      {
        \seq_set_split:Nnn \g_workday_seq { ~ } { #2 }
        \seq_item:Nn \g_workday_seq {\int_eval:n{\int_div_truncate:nn {##1}{16} +2}}
      }
  }
\ExplSyntaxOff



\NewDocumentEnvironment{Timetable}{md<>O{c}mO{\isWorkday:n}}
{
    \calcDays{#4}
    \begin{#1}[#3]{I #4}
    \createDayHeader{#4}
    \\
    & \createDayTimeSlots{#4}
      
    \createIsWorkdayCommand{#5}{#4}
}
{\end{#1}}





\definecolor{Gray}{gray}{0.85}
% Define a column type for the first column: a centered column with a thick vertical rule on both sides.
\newcolumntype{I}{!{\thickvrule}c!{\thickvrule}}


\newcolumntype{A}{*{\blockAmountPerIpaDay}{p{0.4cm}!{\bluevrule}}}

\newcolumntype{H}{>{\columncolor{Gray}}c}



% \parindent=0cm


\begin{document}
\setlength\Lstackgap{1cm}
\pagenumbering{gobble}

\input{vars.tex}
\begin{table}[]\label{my-label}
\begin{Timetable}{tabular}{A H}
    % Sc!{\bluevrule}>{\columncolor[HTML]{BBDAFF}}Sc!{\bluevrule}*{1}{Sc!{\bluevrule}}Sc!{\thickvrule}
% \aDay{} % could probably take hoursPerDay as an argument and date
% \ipaDayHeader{1.1.1970}
% \ipaDayHeader{1.1.1970}
% \holyDayHeader{1.1.1970} &
% \ipaDayHeader{1.1.1970}
% \aDay{} % could probably take hoursPerDay as an argument and date
% \aDay{} % could probably take hoursPerDay as an argument and date
\task{123}{2}{4}
% \task{456}{2}{4}
% \task{456}{2}{4}
% % \task{098}{2}{4}
% \hline

% \\
% \hhline{*{10}{-}>{\arrayrulecolor[HTML]{BBDAFF}}->{\arrayrulecolor{black}}*{8}{-}}

% Tue
% & \multicolumn{3}{c}{\cellcolor[HTML]{FFFC9E}\color{IndianRed3}E 2 : Class} 
% & \SsHh
% & \Greencells{3}{Cc Mm} 
% & \Lightbluecells{2}{Aa Dd}
% & \cellcolor[HTML]{BBDAFF}
% & \emptycells{2}
% & \SsHh
% & \Greencells{2}{Aa Mm}
% &  \emptycells{2}  & 
% \\
% \hhline{*{10}{-}>{\arrayrulecolor[HTML]{BBDAFF}}->{\arrayrulecolor{black}}*{8}{-}}

% Wed
% &  \emptycells{2}
% & \Greencells{3}{Pp Gg}
% & \SsHh
% & \multicolumn{1}{c}{\cellcolor[HTML]{340096}{\color{white}Tt Kk}}
% &  \emptycells{1} 
% & \multicolumn{1}{c}{\cellcolor[HTML]{340096}{\color{white}Hh Ss}}
% & \cellcolor[HTML]{BBDAFF}
% & \Cc
% &\SsHh
% & \Cc
% &  \emptycells{2} &
% \\
% \hhline{*{10}{-}>{\arrayrulecolor[HTML]{BBDAFF}}->{\arrayrulecolor{black}}*{8}{-}}

% Thu
% & \multicolumn{3}{c}{\cellcolor[HTML]{FFFC9E}\color{IndianRed3}E 2 : Class}
% & \SsHh
% & \Greencells{3}{Ss Rr}
% & \multicolumn{1}{c}{\cellcolor[HTML]{F8A102}\begin{tabular}[c]{@{}c@{}}Sssss\\ Hhhh\end{tabular}}
% & \emptycells{1}
% & \cellcolor[HTML]{BBDAFF}
% & \multicolumn{2}{c}{\cellcolor[HTML]{34CDF9}\begin{tabular}[c]{@{}c@{}}Vv \&\\ Ss\end{tabular}}
% & \Cc
% &  \emptycells{3} &
% \\
% \hhline{*{10}{-}>{\arrayrulecolor[HTML]{BBDAFF}}->{\arrayrulecolor{black}}*{8}{-}}

% Fri
% &  \emptycells{3}
% & \Lightbluecells{1}{Aa   Jj}
% & \Lightbluecells{1}{Ss Jj}
% & \multicolumn{2}{Sc}{\cellcolor[HTML]{F8FF00}\begin{tabular}[c]{@{}c@{}}Ff\\ Mm\end{tabular}} & 
%  \emptycells{2} 
% & \multirowthead{-12}{L\\ U\\ N\\ C\\ H}
% & \multicolumn{3}{c}{\cellcolor[HTML]{FE0000}{\color[HTML]{FFFFFF}\begin{tabular}[c]{@{}c@{}}GGGGGGGGG \\ MMMMMM\end{tabular}}}
% & \multicolumn{3}{c}{\cellcolor[HTML]{F8FF00}Ll Ss}
% &  \emptycells{1}  &
% \\
% \hhline{*{19}{-}}
% \rowcolor[HTML]{C2E7C2}
% Sat
% & \multicolumn{18}{c|}{\Gape[21pt][16pt]{}}
% \\
% \hhline{*{19}{-}}

\end{Timetable}
% \end{tabular}
\end{table}
blockAmountPerIpaDay: \blockAmountPerIpaDay
blockAmount: \blockAmount

\end{document} 